

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; Wishbone master documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'master',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Wishbone master documentation" href="index.html" />
    <link rel="next" title="Bootstrapfiles" href="bootstrapfiles.html" />
    <link rel="prev" title="WishBone" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="bootstrapfiles.html" title="Bootstrapfiles"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="WishBone"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Wishbone master documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>A Wishbone event pipeline setup typically receives data from some external source such as an UDP server or a message broker like RabbitMQ.  The incoming data then travels a set of modules, each with a specific function, after which the data exits to a destination.</p>
<p>Wishbone can bootstrap an event pipeline setups using a configuration file, which allows you to easily alter the configuration of your setup.
The Parallelserver implementation allows you to start, stop and daemonize one or multiple parallel setups using a bootstrap configuration file.</p>
<div class="section" id="wishbone-modules">
<h2>Wishbone modules<a class="headerlink" href="#wishbone-modules" title="Permalink to this headline">¶</a></h2>
<p>A Wishbone event pipeline consists out of multiple interconnected modules.  Each module is a functionally isolated block of code which preferably does only 1 thing.
Each module has at least 2 queues called inbox and outbox.  The modules consume the events arriving in their inbox queue and are put into the outbox queue after processing.
The framework takes care of forwarding the content the outbox queue to the next modules inbox queue.  Modules work independently and asynchronously from each other.</p>
<p>When the modules are loaded into the WishBone and the setup has started then the framework will automatically start the consume the events arriving in the module&#8217;s inbox and execute the module&#8217;s consume() function to each message.  It is up to the user to determine when an events needs to be put back into the module&#8217;s outbox queue.</p>
<p>Although it&#8217;s not necessarily a strict rule, we could say there are 2 types of modules:</p>
<ul class="simple">
<li>IOmodules:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Receive data from or submit data outside the Wishbone framework.</li>
<li>Responsible to convert data coming from the outside into the correct internal Wishbone format.</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Modules:</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>Receive, process and submit events to other modules.</li>
</ul>
</div></blockquote>
<p>The Wishbone modules are hosted on Github:</p>
<p><a class="reference external" href="https://github.com/smetj/wishboneModules">https://github.com/smetj/wishboneModules</a></p>
<p>You can find an example for a basic module here:</p>
<p><a class="reference external" href="https://github.com/smetj/wishboneModules/blob/master/modules/wb_stdout/wb_stdout/stdout.py">https://github.com/smetj/wishboneModules/blob/master/modules/wb_stdout/wb_stdout/stdout.py</a></p>
<p>Modules are installed and available to Wishbone by creating an entrypoint.
Here you can find an example setup.py which installs a module named STDOUT in the wishbone.module group:</p>
<p><a class="reference external" href="https://github.com/smetj/wishboneModules/blob/master/modules/wb_stdout/setup.py">https://github.com/smetj/wishboneModules/blob/master/modules/wb_stdout/setup.py</a></p>
<p>You can use the &#8220;list&#8221; server command to list all modules available to Wishbone.</p>
<div class="section" id="routing">
<h3>Routing<a class="headerlink" href="#routing" title="Permalink to this headline">¶</a></h3>
<p>The path an events takes inside the event pipeline is determined by connecting the messages queues of the different modules to each other.  Not every event needs to follow the same path.  Modules have by default 2 queues: inbox and outbox.  A user can choose to add a number of custom queues to the module which allows more complex routing setups.</p>
<p>Possible connections are:</p>
<ul class="simple">
<li>1-1   : The most standard connection. Events from 1 queue go into another queue.</li>
<li>1-n   : 1 to many connection.  This duplicates the events from 1 queue to each queue it is connected to.</li>
<li>n-1   : Many to one connection.  This writes the events of many queues into 1 queue. (not implemented yet)</li>
</ul>
<p>The path an event travels is determined by the &#8220;routingtable&#8221; in the bootstrap file.
By connecting the queues of different modules to each other, youe can make a clean workflow.</p>
</div>
<div class="section" id="events">
<h3>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p>Data coming into one of the &#8220;IO modules&#8221; is in whatever format. The moment data leaves the IO module it should have the right format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;headers&#39;</span><span class="p">:{},</span><span class="s">&#39;data&#39;</span><span class="p">:</span><span class="n">data</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The moment Wishbone shovels an event from one queue to the other it will drop the event if it doesn&#8217;t have the right format.</p>
</div>
</div>
</div>
<div class="section" id="parallelserver">
<h2>ParallelServer<a class="headerlink" href="#parallelserver" title="Permalink to this headline">¶</a></h2>
<p><tt class="xref py py-class docutils literal"><span class="pre">wishbone.server.ParallelServer</span></tt> is a convenience class which has 3 functions:</p>
<div class="section" id="process-handling-and-parallelisation">
<h3>Process handling and parallelisation.<a class="headerlink" href="#process-handling-and-parallelisation" title="Permalink to this headline">¶</a></h3>
<p><tt class="xref py py-class docutils literal"><span class="pre">wishbone.server.ParallelServer</span></tt> takes care of the starting, stopping and daemonizing of a Wishbone setup.
Besides that it also takes care of starting multiple parallel instances when required.
Having more than one instance means there is a libevent loop per process.</p>
</div>
<div class="section" id="argument-parsing">
<h3>Argument parsing.<a class="headerlink" href="#argument-parsing" title="Permalink to this headline">¶</a></h3>
<p><tt class="xref py py-class docutils literal"><span class="pre">wishbone.server.ParallelServer</span></tt> takes care of parsing the command line arguments required to bootstrap a Wishbone setup.</p>
<div class="highlight-text"><div class="highlight"><pre>[vagrant@sandbox broker]$ ./brokertest
BrokerTest version 0.1                                          Jelle Smet

This setup generates a feedback loop to the RabbitMQ message broker.

/usr/bin/brokertest command --config file [--instances number] [--loglevel level] [--pid filename] [--group groupname]


Commands:

    start           Starts and daemonizes the program into the background.
    stop            Stops a daemonized instance.
    debug           Starts the program in the foreground without detaching.
    kill            Kills the daemonized instance.
    list            Lists the available Wishbone modules in group

Parameters:

    --config        The filename of the bootstrap config file.

    --instances     The number of parallel instances to start. Default is 1.

    --loglevel      Defines the loglevel to use. Default is &quot;info&quot;.
                    Possible values are:
                        info, warning, critical, debug

    --pid           Defines the location of the pidfile.
                    The default value is /tmp/PySeps.pid

    --group         The name of the module group to list modules from.




    Support: https://groups.google.com/forum/?fromgroups=#!forum/python-wishbone

too few arguments

[vagrant@sandbox broker]$ ./brokertest debug --config brokertest.json --loglevel debug
2012-11-25 16:38:30,202 INFO Server: Starting BrokerTest in foreground.
2012-11-25 16:38:30,205 INFO Server: Instance #0 started.
2012-11-25 16:38:30,208 INFO Server: Started with pids: 3068, 3069
2012-11-25 16:38:30,280 INFO Broker: Initiated
2012-11-25 16:38:30,282 INFO Intance #0:loopback: Initiated.
2012-11-25 16:38:30,314 INFO Intance #0:loopback: Started.
2012-11-25 16:38:30,314 INFO Broker: Started
...
</pre></div>
</div>
</div>
<div class="section" id="bootstrapping">
<h3>Bootstrapping<a class="headerlink" href="#bootstrapping" title="Permalink to this headline">¶</a></h3>
<p><tt class="xref py py-class docutils literal"><span class="pre">wishbone.server.ParallelServer</span></tt> reads the configuration file (using the &#8211;config parameter) and starts a setup according to the configuration.
The configuration file (bootstrap file) is in JSON format and consists out of 4 big parts:</p>
<ul>
<li><p class="first">system</p>
<p>Optional and currently unused.  Reserved for future usage.</p>
</li>
<li><p class="first">metrics</p>
<p>Contains settings which controls how the internal metrics are handled.</p>
</li>
<li><p class="first">bootstrap</p>
<p>Contains which modules to initiate and the parameters which should be used.</p>
</li>
<li><p class="first">routingtable</p>
<p>Contains the information of which modules are connected to each other.</p>
</li>
</ul>
<p>For more information see:</p>
<p><a class="reference internal" href="bootstrapfiles.html#bootstrapfiles"><em>Bootstrapfiles</em></a></p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#wishbone-modules">Wishbone modules</a><ul>
<li><a class="reference internal" href="#routing">Routing</a></li>
<li><a class="reference internal" href="#events">Events</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parallelserver">ParallelServer</a><ul>
<li><a class="reference internal" href="#process-handling-and-parallelisation">Process handling and parallelisation.</a></li>
<li><a class="reference internal" href="#argument-parsing">Argument parsing.</a></li>
<li><a class="reference internal" href="#bootstrapping">Bootstrapping</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">WishBone</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="bootstrapfiles.html"
                        title="next chapter">Bootstrapfiles</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/introduction.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="bootstrapfiles.html" title="Bootstrapfiles"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="WishBone"
             >previous</a> |</li>
        <li><a href="index.html">Wishbone master documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Jelle Smet.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>