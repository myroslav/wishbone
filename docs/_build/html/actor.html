<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Actor &mdash; Wishbone 0.5.0 documentation</title>
    
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Wishbone 0.5.0 documentation" href="index.html" />
    <link rel="next" title="Router" href="router.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head>
  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="router.html" title="Router"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Wishbone 0.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="actor">
<h1>Actor<a class="headerlink" href="#actor" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Modules are isolated blocks of code (greenlets) each with their own specific
functionality. They are created by simply inheriting
<a class="reference internal" href="#wishbone.Actor" title="wishbone.Actor"><tt class="xref py py-class docutils literal"><span class="pre">wishbone.Actor</span></tt></a> as a baseclass. Modules cannot directly invoke each
others functionality. Their only means of interaction is by passing messages
or events to each other&#8217;s <a class="reference internal" href="#wishbone.tools.WishboneQueue" title="wishbone.tools.WishboneQueue"><tt class="xref py py-class docutils literal"><span class="pre">wishbone.tools.WishboneQueue</span></tt></a> queues.
Modules typically have, but are not limited to, an inbox, outbox, successful
and failed queue.</p>
<p>Queues always live inside a <tt class="xref py py-class docutils literal"><span class="pre">Wishbone.queue.QueuePool</span></tt> which,
besides offering some convenience functions, is nothing more than a container
to centralize all the queues of the module. Typically, modules consume each
event entering the inbox queue using the <tt class="xref py py-func docutils literal"><span class="pre">wishbone.Actor.consume()</span></tt>
function where the event can be processed and after which it is submitted to
the module&#8217;s outbox queue from where it can be forwarded again to another
module&#8217;s queue.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>As an example, let&#8217;s make a module which reverses the content of incoming
events and optionally converts the first letter into a capital.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">wishbone</span> <span class="kn">import</span> <span class="n">Actor</span>


<span class="k">class</span> <span class="nc">ReverseData</span><span class="p">(</span><span class="n">Actor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;**Sample module which reverses incoming events.**</span>

<span class="sd">    Parameters:</span>

<span class="sd">        - name (str):       The instance name.</span>

<span class="sd">        - capitalize(bool): When True capitalizes the</span>
<span class="sd">                            first letter.</span>
<span class="sd">                            Default: True</span>

<span class="sd">    Queues:</span>

<span class="sd">        - inbox:    Incoming events.</span>

<span class="sd">        - outbox:   Outgoing events.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">capitalize</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">Actor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">createQueue</span><span class="p">(</span><span class="s">&quot;inbox&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="o">.</span><span class="n">createQueue</span><span class="p">(</span><span class="s">&quot;outbox&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registerConsumer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">,</span> <span class="s">&quot;inbox&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">capitalize</span> <span class="o">=</span> <span class="n">capitalize</span>

    <span class="k">def</span> <span class="nf">preHook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Hello from preHook&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">postHook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&quot;Goodbye from postHook&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">capitalize</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
        <span class="n">event</span><span class="p">[</span><span class="s">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">queuepool</span><span class="o">.</span><span class="n">outbox</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<hr class="docutils" />
<p>So let&#8217;s break down what we are seeing here:</p>
<p>We inherit the Actor base class [4] and initialize it [21].  We pass it the a
name and the <tt class="xref py py-data docutils literal"><span class="pre">setupbasic</span></tt> parameter [21].  The setupbasic parameter
does nothing than creating an inbox and outbox queue and registring the
consume() function as the function which is going to process the events
arriving to inbox by calling the <tt class="xref py py-func docutils literal"><span class="pre">wishbone.Actor.createQueue()</span></tt> and
<a class="reference internal" href="#wishbone.Actor.registerConsumer" title="wishbone.Actor.registerConsumer"><tt class="xref py py-func docutils literal"><span class="pre">wishbone.Actor.registerConsumer()</span></tt></a> in the background.</p>
<p>When <tt class="xref py py-data docutils literal"><span class="pre">setupbasic</span></tt> is False you will have to create the required
queues and register the required consume yourself.</p>
<p>Wishbone modules can produce log messages [24] using the functions from
<a class="reference internal" href="#wishbone.tools.QLogging" title="wishbone.tools.QLogging"><tt class="xref py py-class docutils literal"><span class="pre">wishbone.tools.QLogging</span></tt></a>.  Logs are collected by the router and can
be forwarded to other modules for further processing, so we don&#8217;t need to
worry any further about that.</p>
<p>Our module itself accepts 1 parameter [21] which we can use to modify its
behaviour and which we can use when registering the module in the router using
<tt class="xref py py-func docutils literal"><span class="pre">wishbone.router.Default.register()</span></tt>.</p>
<p>In the background, the Actor module takes care of consuming the events
arriving to the inbox and invoking the <tt class="xref py py-func docutils literal"><span class="pre">wishbone.Actor.consume()</span></tt> [26]
on each one of them.  Events always have following format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span> <span class="s">&quot;header&quot;</span><span class="p">:{},</span> <span class="s">&quot;data&quot;</span><span class="p">:</span> <span class="nb">object</span> <span class="p">}</span>
</pre></div>
</div>
<p>So we change the content of data [28-34] according to the modules behaviour.</p>
<p>Last but not least, our modified event needs to go to another module.
Remember modules don&#8217;t communicate directly to each other? That&#8217;s why we put
them into the outbox queue [36] for another module to consume.</p>
<p>And that&#8217;s it.  Save your module and make sure you can import it as a regular
Python module and that you can import it an entrypoint.</p>
<hr class="docutils" />
<dl class="class">
<dt id="wishbone.Actor">
<em class="property">class </em><tt class="descclassname">wishbone.</tt><tt class="descname">Actor</tt><big>(</big><em>name</em>, <em>size=100</em>, <em>frequency=1</em><big>)</big><a class="headerlink" href="#wishbone.Actor" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="wishbone.Actor.connect">
<tt class="descname">connect</tt><big>(</big><em>source</em>, <em>instance</em>, <em>destination</em><big>)</big><a class="headerlink" href="#wishbone.Actor.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Connects the &lt;source&gt; queue to the &lt;destination&gt; queue.
In fact, the source queue overwrites the destination queue.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.flushQueuesToDisk">
<tt class="descname">flushQueuesToDisk</tt><big>(</big><big>)</big><a class="headerlink" href="#wishbone.Actor.flushQueuesToDisk" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes whatever event in the queue to disk for later retrieval.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.getChildren">
<tt class="descname">getChildren</tt><big>(</big><em>queue=None</em><big>)</big><a class="headerlink" href="#wishbone.Actor.getChildren" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the queue name &lt;queue&gt; is connected to.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.loop">
<tt class="descname">loop</tt><big>(</big><big>)</big><a class="headerlink" href="#wishbone.Actor.loop" title="Permalink to this definition">¶</a></dt>
<dd><p>The global lock for this module</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.readQueuesFromDisk">
<tt class="descname">readQueuesFromDisk</tt><big>(</big><big>)</big><a class="headerlink" href="#wishbone.Actor.readQueuesFromDisk" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads events from disk into the queue.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.registerAdminCallback">
<tt class="descname">registerAdminCallback</tt><big>(</big><em>function</em><big>)</big><a class="headerlink" href="#wishbone.Actor.registerAdminCallback" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers &lt;function&gt; to respond to the incoming admin messages.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.registerConsumer">
<tt class="descname">registerConsumer</tt><big>(</big><em>function</em>, <em>queue</em><big>)</big><a class="headerlink" href="#wishbone.Actor.registerConsumer" title="Permalink to this definition">¶</a></dt>
<dd><p>Registers &lt;function&gt; to process all events in &lt;queue&gt;</p>
<p>Do not trap errors.  When &lt;function&gt; fails then the event will be
submitted to the &#8220;failed&#8221; queue,  If &lt;function&gt; succeeds to the
success queue.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.start">
<tt class="descname">start</tt><big>(</big><big>)</big><a class="headerlink" href="#wishbone.Actor.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the module.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.stop">
<tt class="descname">stop</tt><big>(</big><big>)</big><a class="headerlink" href="#wishbone.Actor.stop" title="Permalink to this definition">¶</a></dt>
<dd><p>Kills all registered Consumers.</p>
</dd></dl>

<dl class="method">
<dt id="wishbone.Actor.submit">
<tt class="descname">submit</tt><big>(</big><em>event</em>, <em>queue</em><big>)</big><a class="headerlink" href="#wishbone.Actor.submit" title="Permalink to this definition">¶</a></dt>
<dd><p>A convenience function which submits &lt;event&gt; to &lt;queue&gt;
and deals with QueueFull and the module lock set to False.</p>
</dd></dl>

</dd></dl>

<hr class="docutils" />
<dl class="class">
<dt id="wishbone.tools.QueuePool">
<em class="property">class </em><tt class="descclassname">wishbone.tools.</tt><tt class="descname">QueuePool</tt><a class="headerlink" href="#wishbone.tools.QueuePool" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<hr class="docutils" />
<dl class="class">
<dt id="wishbone.tools.WishboneQueue">
<em class="property">class </em><tt class="descclassname">wishbone.tools.</tt><tt class="descname">WishboneQueue</tt><a class="headerlink" href="#wishbone.tools.WishboneQueue" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<hr class="docutils" />
<dl class="class">
<dt id="wishbone.tools.QLogging">
<em class="property">class </em><tt class="descclassname">wishbone.tools.</tt><tt class="descname">QLogging</tt><a class="headerlink" href="#wishbone.tools.QLogging" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Actor</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="router.html"
                        title="next chapter">Router</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="router.html" title="Router"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">Wishbone 0.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Jelle Smet.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>